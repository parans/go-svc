# deploy-service
A platform service to deploy Kubernetes Charts 

## Prerequisites
------------------------
* docker
* go
* dep - dependency management tool: `brew install dep`


## Prepare Workspace
-------------------
- Fork https://github.td.teradata.com/appcenter/deploy-service to your personal account.

- Create appcenter org if not exists
```
cd $GOPATH/src/github.td.teradata.com && mkdir -p appcenter \
```

- clone git repo from your fork: Substitute your fork id (quicklook id) in below command
```
git clone git@github.td.teradata.com:<QUICKLOOK-ID>/deploy-service.git
```

- Change remote name "origin" to your name
```
	git remote rename origin <YOUR_NAME>
```

- Set Upstream remote
```
	git remote add upstream git@github.td.teradata.com:appcenter/deploy-service.git
```

- Create branch, write and test your code

- Rebase your changes from upstream master
```
	git pull --rebase upstream master
```

- Push your changes to your fork
```
	git push <YOUR_NAME> <YOUR_BRANCH_NAME>
```

- File PR against upstream repo from the github Web App.

Helpful links that explains working with forks for golang projects:
- https://golang.org/doc/code.html#ImportPaths
- https://blog.sgmansfield.com/2016/06/working-with-forks-in-go/

## Project structure
-----------------------
- api: swagger file for the API
- cmd: all executable commands and subcommands
- config: configuration needed to start the application
- docs: documentation generated by godoc command 
- internal: Any code that will not be shared by external projects
- pkg: A golang library. Any code that could be used by external projects
- vendor: Auto generated

## Build and Install project
------------------------------
Setup and install deploy-service: `make all`

Following are individual commands:
- setup: `make setup`
- dependency: `make dep`
- build: `make build`
- install: `make install`
- test: `make test`
- clean:`make clean`
- generate:`make generate`
- run: `$GOPATH/bin/deploy-service`

## Run deploy-service
------------------------------------
default:
`deploy-service` will run deploy-service with default configuration.

With configuration file:
`deploy-service -c config.yaml` check `sample_config.yaml` to see available configuration

With Environment variables:
Any configuration specified in `sample_config.yaml` can be represented using environment variable prefixed with `DEPLOY_SERVICE` . ex `DEPLOY_SERIVCE_PORT` will represent port used by http server.
once all environment variables are provided, run deploy service as `deploy-service`


## Add Dependency
---------------
`glide get github.com/baz/quux`

## MiddleWares
-----------
https://justinas.org/alice-painless-middleware-chaining-for-go/

## Swagger
-----------
Annotation for endpoints:
When you add a new endpoint, add swagger annotation on top of your handler function.
you can use either 'swagger:route' or 'swagger:operation':
https://goswagger.io/generate/spec/route.html
https://goswagger.io/generate/spec/operation.html

Annotation for models:
You can annotate your model with 'swagger:model'. it will be added to 'definitions":
https://goswagger.io/generate/spec/model.html

You can also annotate models with 'swagger:parameters' or 'swagger:response':
https://goswagger.io/generate/spec/params.html
https://goswagger.io/generate/spec/response.html

Once you are done with code annotations, run:
make generate

A new swagger.json is generated in swaggerui/ directory.
Run deploy-service. Now you can access swagger from:
http://localhost:8080/swaggerui/
